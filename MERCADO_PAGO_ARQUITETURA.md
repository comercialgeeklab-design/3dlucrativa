# ðŸ“Š Arquitetura da IntegraÃ§Ã£o Mercado Pago

## ðŸ—ï¸ Diagrama de Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Browser)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           MercadoPagoCheckout Component (React)                    â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ 1. Escolher MÃ©todo de Pagamento                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ CartÃ£o de CrÃ©dito                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ PIX / QR Code                                          â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ 2. FormulÃ¡rio / GeraÃ§Ã£o de QR Code                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ Dados: Nome, Email, CPF                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ QR Code SVG (renderizado)                              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ 3. Polling de Status (a cada 5s)                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ GET /api/payment/mercadopago?id=...                    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ 4. Feedback Visual                                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ â³ Processando...                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ âœ… Aprovado!                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ âŒ Rejeitado                                            â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  Carrega SDK: https://sdk.mercadopago.com/js/v2                        â”‚
â”‚  (com Public Key)                                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†‘
                                   â”‚
                 POST /api/payment/mercadopago
                 GET /api/payment/mercadopago
                                   â”‚
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND (Next.js)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         API Routes (/app/api/payment/)                          â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ mercadopago/route.ts                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ POST: Inicia Pagamento                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Valida JWT Token                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Cria registro PaymentRequest                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Chama MercadoPagoService                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â”œâ”€ PIX: Gera QR Code                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚     â””â”€ CARTÃƒO: Processa Pagamento                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Salva resposta no BD                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Retorna QR Code ou Status                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ GET: Verifica Status                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Busca PaymentRequest no BD                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Retorna status atual                                â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ webhook/route.ts                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ POST: NotificaÃ§Ã£o do Mercado Pago                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Recebe: { type, data, action }                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Busca pagamento no BD                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Atualiza status                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Dispara eventos (email, ativa plano, etc)           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ GET: Health Check                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ Retorna: { status: "ok" }                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         MercadoPagoService (/lib/external-apis/)               â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ createPayment(data)                                        â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ POST https://api.mercadopago.com/v1/payments           â”‚  â”‚
â”‚  â”‚  â”‚     (com Access Token)                                      â”‚  â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ createPixQrCode(amount, ref, desc)                        â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ POST https://api.mercadopago.com/v1/qr/...             â”‚  â”‚
â”‚  â”‚  â”‚     (Gera QR Code PIX)                                      â”‚  â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”œâ”€ getPayment(id)                                             â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ GET https://api.mercadopago.com/v1/payments/{id}       â”‚  â”‚
â”‚  â”‚  â”‚     (Verifica status)                                       â”‚  â”‚
â”‚  â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â””â”€ mapPaymentStatus(mpStatus)                                 â”‚  â”‚
â”‚  â”‚     â””â”€ Mapeia MP â†’ Sistema interno                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Database (TypeORM)                                 â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  PaymentRequest                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ id (UUID)                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ userId (FK)                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ paymentMethod (credit_card | pix)                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ amount                                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ status (pending | approved | rejected)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ mercadoPagoPaymentId                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ mercadoPagoQrCodeUrl                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ mercadoPagoQrCodeData                                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ mercadoPagoPaymentMethod                                   â”‚  â”‚
â”‚  â”‚  â””â”€ mercadoPagoMetadata (JSON)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†‘â†“
                         HTTP/REST API Calls
                                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         â”‚                         â”‚
         â†“                         â†“                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mercado Pago    â”‚      â”‚   Banco do       â”‚      â”‚   UsuÃ¡rio        â”‚
â”‚   Payment API    â”‚      â”‚   UsuÃ¡rio        â”‚      â”‚  (Webhook)       â”‚
â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚
â”‚ â€¢ Processa       â”‚      â”‚ â€¢ Valida CartÃ£o  â”‚      â”‚ â€¢ Escaneia QR    â”‚
â”‚   CartÃ£o         â”‚      â”‚ â€¢ Autoriza $     â”‚      â”‚ â€¢ Faz Transf.    â”‚
â”‚                  â”‚      â”‚ â€¢ Retorna status â”‚      â”‚ â€¢ Confirma       â”‚
â”‚ â€¢ Gera QR PIX    â”‚      â”‚                  â”‚      â”‚   Pagamento      â”‚
â”‚                  â”‚      â”‚                  â”‚      â”‚                  â”‚
â”‚ â€¢ Notifica via   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚   Webhook        â”‚                         â”‚      â”‚
â”‚                  â”‚                         â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Fluxo de Pagamento com PIX

```
USUÃRIO                       FRONTEND                       BACKEND                  MERCADO PAGO
   â”‚                            â”‚                              â”‚                           â”‚
   â”œâ”€ Clica em PIX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚                           â”‚
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚                            â”œâ”€ POST /api/payment/mp â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                            â”‚   {paymentMethod: 'pix'}     â”‚                           â”‚
   â”‚                            â”‚                              â”œâ”€ POST /v1/qr/... â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                            â”‚                              â”‚   (cria QR Code)         â”‚
   â”‚                            â”‚                              â”‚<â”€â”€â”€â”€â”€â”€ QR Code SVG â”€â”€â”€â”€â”€â”€â”¤
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚                            â”‚<â”€â”€â”€â”€â”€ QR Code + ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€ QR Code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚                           â”‚
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚ (Escaneia com telefone)    â”‚                              â”‚                           â”‚
   â”‚                            â”‚  GET (polling a cada 5s)     â”‚                           â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>                        â”‚
   â”‚  Abre app do banco         â”‚                              â”‚                           â”‚
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚ (Faz PIX)                  â”‚                              â”‚  Mercado Pago recebe PIX â”‚
   â”‚                            â”‚                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚                            â”‚                              â”‚ Webhook: payment.updatedâ”‚
   â”‚                            â”‚<â”€â”€â”€ POST /webhook â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
   â”‚                            â”‚   {type: 'payment'}          â”‚                           â”‚
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚                            â”‚ Atualiza status no BD        â”‚                           â”‚
   â”‚                            â”‚                              â”‚                           â”‚
   â”‚<â”€â”€â”€ âœ… Pagamento Confirmado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
```

---

## ðŸ”„ Fluxo de Pagamento com CartÃ£o

```
USUÃRIO                FRONTEND              BACKEND         MERCADO PAGO
   â”‚                     â”‚                    â”‚                   â”‚
   â”œâ”€ CartÃ£o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
   â”‚                     â”‚                    â”‚                   â”‚
   â”œâ”€ Dados do CartÃ£o   â”‚                    â”‚                   â”‚
   â”‚  (Nome, Email)     â”‚                    â”‚                   â”‚
   â”‚                     â”‚                    â”‚                   â”‚
   â”œâ”€ Clica Pagar â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
   â”‚                     â”œâ”€ POST /mercadopagoâ”€>â”‚                   â”‚
   â”‚                     â”‚  {cardToken,data}  â”‚                   â”‚
   â”‚                     â”‚                    â”œâ”€ POST /payments â”€â”€>â”‚
   â”‚                     â”‚                    â”‚  (com Access Token)â”‚
   â”‚                     â”‚                    â”‚                   â”‚
   â”‚                     â”‚                    â”‚<â”€â”€ Processando â”€â”€â”€â”¤
   â”‚                     â”‚                    â”‚                   â”‚
   â”‚                     â”‚                    â”‚<â”€â”€ Resposta â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚                    â”‚  {status, id}     â”‚
   â”‚                     â”‚<â”€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”¤                   â”‚
   â”‚<â”€â”€â”€ Resultado â”€â”€â”€â”€â”€â”¤                    â”‚                   â”‚
   â”‚  âœ… ou âŒ           â”‚                    â”‚                   â”‚
```

---

## ðŸ“ Estrutura de Arquivos

```
projeto/
â”‚
â”œâ”€â”€ ðŸ“„ MERCADO_PAGO_START.md          â† COMEÃ‡AR AQUI!
â”œâ”€â”€ ðŸ“„ MERCADO_PAGO_SETUP.md          â† Setup detalhado
â”œâ”€â”€ ðŸ“„ MERCADO_PAGO_CHECKLIST.md      â† ImplementaÃ§Ã£o
â”œâ”€â”€ ðŸ“„ MERCADO_PAGO_TROUBLESHOOTING.md â† Problemas
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ external-apis/
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ mercadopago.ts              â† ServiÃ§o Principal
â”‚   â”‚   â””â”€â”€ ðŸ“„ mercadopago.examples.ts     â† Exemplos
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ ðŸ“„ mercadopago.ts              â† Types TS
â”‚   â””â”€â”€ database/entities/
â”‚       â””â”€â”€ ðŸ“„ PaymentRequest.ts           â† BD (modificado)
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/payment/
â”‚   â”‚   â”œâ”€â”€ mercadopago/
â”‚   â”‚   â”‚   â””â”€â”€ ðŸ“„ route.ts                â† API Payment
â”‚   â”‚   â””â”€â”€ webhook/
â”‚   â”‚       â””â”€â”€ ðŸ“„ route.ts                â† Webhook
â”‚   â””â”€â”€ payment/
â”‚       â””â”€â”€ mercadopago/
â”‚           â””â”€â”€ ðŸ“„ page.tsx                â† PÃ¡gina
â”‚
â””â”€â”€ components/
    â””â”€â”€ ðŸ“„ MercadoPagoCheckout.tsx      â† Componente React
```

---

## ðŸ” Fluxo de SeguranÃ§a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dados UsuÃ¡rio â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ Frontend: Envia dados
         â”‚  âš ï¸ SEM nÃºmeros de cartÃ£o
         â”‚  (cartÃ£o tokenizado via SDK)
         â”‚
         â””â”€â”€> Backend (JWT validado)
               â”‚
               â”œâ”€ Valida entrada
               â”‚
               â””â”€â”€> Mercado Pago API
                    â”‚
                    â”œâ”€ Usa Access Token (secreto!)
                    â”‚
                    â””â”€> Processa Pagamento
                         â”‚
                         â””â”€> Webhook Notification
                             â”‚
                             â””â”€> Atualiza BD
                                 â”‚
                                 â””â”€> Eventos
                                     (email, ativa plano)
```

---

## ðŸ“Š Status Mapping

```
Mercado Pago Status          â†’   Sistema Interno
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pending                      â†’   pending
approved                     â†’   approved
authorized                   â†’   approved
in_process                   â†’   pending
in_mediation                 â†’   pending
rejected                     â†’   rejected
cancelled                    â†’   rejected
refunded                     â†’   rejected
charged_back                 â†’   rejected
```

---

## ðŸš€ Deployment

```
DESENVOLVIMENTO              PRODUÃ‡ÃƒO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
http://localhost:3000        https://seu-dominio.com
TEST- Keys                   Chaves PRODUÃ‡ÃƒO
Ngrok Webhook               URL Real Webhook
Logs em Console             Sistema de Logs
```

---

Diagrama criado em: 17 de Janeiro de 2026 âœ¨
